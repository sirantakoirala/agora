{"ast":null,"code":"var _jsxFileName = \"E:\\\\Uni\\\\Project\\\\qna_forum\\\\Agora v1.0.2\\\\src\\\\components\\\\User\\\\Profile.js\",\n    _s = $RefreshSig$();\n\nimport React, { useState, useEffect } from \"react\";\nimport { Button, Form, Header, Image, Loader, Dimmer, Message, Segment, Check, Checkbox, Icon, Container } from \"semantic-ui-react\";\nimport { Sidebar } from \"../Dashboard/Sidebar\";\nimport AgoraLogo from \"../../images/logo.png\";\nimport { useUserContext } from \"../../context/userContext\";\nimport { updateEmail, updatePassword } from \"firebase/auth\";\nimport { auth } from \"../../firebase-config\";\nimport { ref, getDownloadURL, uploadBytesResumable } from \"firebase/storage\";\nimport { updateDoc, doc } from \"firebase/firestore\";\nimport { db, storage } from \"../../firebase-config\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport const Profile = () => {\n  _s();\n\n  const initialState = {\n    userName: \"\",\n    email: \"\",\n    address: \"\",\n    birthdate: \"\",\n    phoneNumber: \"\",\n    password: \"\",\n    confirmPassword: \"\",\n    role: \"student\",\n    avatarUrl: \"https://react.semantic-ui.com/images/wireframe/image.png\",\n    avatar: null\n  };\n  const initalChangeState = {\n    userName: false,\n    email: false,\n    address: false,\n    birthdate: false,\n    phoneNumber: false,\n    password: false,\n    confirmPassword: false,\n    role: false,\n    avatarUrl: false,\n    avatar: false\n  };\n  const [loading, setLoading] = useState(false);\n  const [formState, setFormState] = useState(initialState);\n  const [formChangeState, setChangeState] = useState(initalChangeState);\n  const [isUpdateInProgress, setUpdateInProgress] = useState(false);\n  const {\n    updateUserPassword,\n    currentUser\n  } = useUserContext();\n  const [isSuccess, setIsSuccess] = useState(false);\n  const [passAndConfirmPass, setPassAndConfirmPass] = useState(true);\n  const [passValid, setPassValid] = useState(true);\n  useEffect(() => {\n    const getProfile = async () => {\n      try {\n        setFormState(prev => ({ ...prev,\n          role: currentUser.role,\n          email: currentUser.email,\n          phoneNumber: currentUser.phone,\n          address: currentUser.address,\n          birthdate: currentUser.birthdate,\n          avatarUrl: currentUser.avatar == undefined ? \"/images/uicon.png\" : currentUser.avatar,\n          userName: currentUser.uname\n        }));\n        console.log(formState);\n      } catch (err) {\n        console.log(err);\n      }\n    };\n\n    getProfile(); //console.log(currentUser.role);\n  }, []);\n\n  const handleUpdate = async () => {\n    console.log(formState);\n    console.log(formChangeState);\n    console.log(formState.isTeacher); // if (\n    //   formState.userName == \"\"||\n    //   formState.email === \"\" ||\n    //   formState.phoneNumber == \"\"||\n    //   formState.password === \"\" ||\n    //   formState.confirmPassword === \"\" ||\n    //   formState.avatar === null\n    // )\n    // {\n    //     return;\n    // }\n\n    if (formState.confirmPassword !== formState.password) {\n      setPassAndConfirmPass(false);\n      return;\n    } // if (\n    //   !formState.password.match(\n    //     /^(?=.*?[A-Z])(?=.*?[a-z])(?=.*?[0-9])(?=.*?[#?!@$%^&*-]).{8,}$/g\n    //   )\n    // ) {\n    //   setPassValid(false);\n    //   return;\n    // }\n\n\n    try {\n      setUpdateInProgress(true); //if(formChangeState.email == true)\n      //const { user } = await updateUserPassword(formState.password);\n\n      if (formChangeState.avatar) {\n        const storageRef = ref(storage, `images/${formState.topicSubject}`);\n        const uploadTask = uploadBytesResumable(storageRef, formState.avatar); // Listen for state changes, errors, and completion of the upload.\n\n        uploadTask.on(\"state_changed\", snapshot => {\n          // Get task progress, including the number of bytes uploaded and the total number of bytes to be uploaded\n          const progress = snapshot.bytesTransferred / snapshot.totalBytes * 100;\n          console.log(\"Upload is \" + progress + \"% done\");\n\n          switch (snapshot.state) {\n            case \"paused\":\n              console.log(\"Upload is paused\");\n              break;\n\n            case \"running\":\n              console.log(\"Upload is running\");\n              break;\n          }\n        }, error => {\n          // A full list of error codes is available at\n          // https://firebase.google.com/docs/storage/web/handle-errors\n          switch (error.code) {\n            case \"storage/unauthorized\":\n              // User doesn't have permission to access the object\n              break;\n\n            case \"storage/canceled\":\n              // User canceled the upload\n              break;\n            // ...\n\n            case \"storage/unknown\":\n              // Unknown error occurred, inspect error.serverResponse\n              break;\n          }\n        }, () => {\n          // Upload completed successfully, now we can get the download URL\n          getDownloadURL(uploadTask.snapshot.ref).then(async downloadURL => {\n            const userCollDoc = doc(db, \"users\", currentUser.uid);\n            await updateDoc(userCollDoc, {\n              avatar: downloadURL\n            });\n            setLoading(false);\n            setUpdateInProgress(false);\n          });\n        });\n      }\n\n      console.log(currentUser.uid);\n      const userDoc = doc(db, \"users\", currentUser.uid);\n      await updateDoc(userDoc, {\n        address: formState.address,\n        phone: formState.phoneNumber,\n        birthdate: formState.birthdate\n      });\n      setIsSuccess(true);\n      setLoading(false);\n      setUpdateInProgress(false);\n    } catch (err) {\n      console.log(err);\n      setIsSuccess(false);\n      setUpdateInProgress(false);\n    }\n  };\n\n  const handleImageChange = ev => {\n    console.log(\"AA\" + URL.createObjectURL(ev.target.files[0]));\n    setFormState(prev => ({ ...prev,\n      avatarUrl: URL.createObjectURL(ev.target.files[0]),\n      [ev.target.id]: ev.target.files[0]\n    }));\n    setChangeState(prev => ({ ...prev,\n      avatarUrl: true,\n      avatar: true\n    }));\n  };\n\n  const handleChange = ev => {\n    setFormState(prev => ({ ...prev,\n      [ev.target.id]: ev.target.value\n    }));\n    setChangeState(prev => ({ ...prev,\n      [ev.target.id]: true\n    }));\n  };\n\n  const handleChangeTeacher = ev => {\n    setFormState(prev => ({ ...prev,\n      [ev.target.id]: ev.target.checked == 0 ? \"student\" : \"teacher\"\n    }));\n  };\n\n  return /*#__PURE__*/_jsxDEV(Sidebar, {\n    children: [loading && /*#__PURE__*/_jsxDEV(Dimmer, {\n      active: true,\n      children: /*#__PURE__*/_jsxDEV(Loader, {\n        size: \"mini\",\n        children: \"Submitting your question....\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 209,\n        columnNumber: 11\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 208,\n      columnNumber: 9\n    }, this), /*#__PURE__*/_jsxDEV(Form, {\n      size: \"large\",\n      onSubmit: handleUpdate,\n      children: /*#__PURE__*/_jsxDEV(Segment, {\n        stacked: true,\n        children: [/*#__PURE__*/_jsxDEV(Form.Input, {\n          label: /*#__PURE__*/_jsxDEV(Image, {\n            label: \"UserFileImage\",\n            src: formState.avatarUrl,\n            size: \"medium\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 216,\n            columnNumber: 15\n          }, this),\n          placeholder: \"\",\n          onChange: handleImageChange,\n          type: \"file\",\n          id: \"avatar\",\n          size: \"small\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 214,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(Form.Input, {\n          fluid: true,\n          label: \"UserName\",\n          icon: \"user\",\n          iconPosition: \"left\",\n          id: \"userName\",\n          onChange: handleChange,\n          defaultValue: formState.userName\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 229,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(Form.Group, {\n          widths: \"equal\",\n          children: [/*#__PURE__*/_jsxDEV(Form.Input, {\n            fluid: true,\n            label: \"Email Address\",\n            icon: \"mail\",\n            iconPosition: \"left\",\n            id: \"email\",\n            onChange: handleChange,\n            defaultValue: formState.email\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 239,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(Form.Input, {\n            fluid: true,\n            label: \"Phone Number\",\n            icon: \"phone\",\n            iconPosition: \"left\",\n            type: \"tel\",\n            onChange: handleChange,\n            id: \"phoneNumber\",\n            defaultValue: formState.phoneNumber,\n            onKeyPress: event => {//if (!/[0-9]/.test(event.key)) {\n              //  event.preventDefault();\n              //}\n            }\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 248,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 238,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(Form.Group, {\n          widths: \"equal\",\n          children: [/*#__PURE__*/_jsxDEV(Form.Input, {\n            fluid: true,\n            label: \"Address\",\n            icon: \"address card\",\n            iconPosition: \"left\",\n            id: \"address\",\n            type: \"address\",\n            defaultValue: formState.address,\n            onChange: handleChange\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 265,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(Form.Input, {\n            fluid: true,\n            label: \"DOB\",\n            icon: \"calendar\",\n            iconPosition: \"left\",\n            id: \"birthdate\",\n            type: \"date\",\n            defaultValue: formState.birthdate,\n            onChange: handleChange\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 275,\n            columnNumber: 13\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 264,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(Button, {\n          color: \"teal\",\n          fluid: true,\n          size: \"large\",\n          type: \"submit\",\n          children: isUpdateInProgress ? /*#__PURE__*/_jsxDEV(Dimmer, {\n            active: true,\n            children: /*#__PURE__*/_jsxDEV(Loader, {\n              size: \"mini\",\n              children: \"Loading\"\n            }, void 0, false, {\n              fileName: _jsxFileName,\n              lineNumber: 320,\n              columnNumber: 17\n            }, this)\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 319,\n            columnNumber: 15\n          }, this) : \"Update\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 317,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 213,\n        columnNumber: 9\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 212,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 206,\n    columnNumber: 5\n  }, this);\n};\n\n_s(Profile, \"OoYmUtpoBXhknv/d0hEUiT/c8MQ=\", false, function () {\n  return [useUserContext];\n});\n\n_c = Profile;\n\nvar _c;\n\n$RefreshReg$(_c, \"Profile\");","map":{"version":3,"sources":["E:/Uni/Project/qna_forum/Agora v1.0.2/src/components/User/Profile.js"],"names":["React","useState","useEffect","Button","Form","Header","Image","Loader","Dimmer","Message","Segment","Check","Checkbox","Icon","Container","Sidebar","AgoraLogo","useUserContext","updateEmail","updatePassword","auth","ref","getDownloadURL","uploadBytesResumable","updateDoc","doc","db","storage","Profile","initialState","userName","email","address","birthdate","phoneNumber","password","confirmPassword","role","avatarUrl","avatar","initalChangeState","loading","setLoading","formState","setFormState","formChangeState","setChangeState","isUpdateInProgress","setUpdateInProgress","updateUserPassword","currentUser","isSuccess","setIsSuccess","passAndConfirmPass","setPassAndConfirmPass","passValid","setPassValid","getProfile","prev","phone","undefined","uname","console","log","err","handleUpdate","isTeacher","storageRef","topicSubject","uploadTask","on","snapshot","progress","bytesTransferred","totalBytes","state","error","code","then","downloadURL","userCollDoc","uid","userDoc","handleImageChange","ev","URL","createObjectURL","target","files","id","handleChange","value","handleChangeTeacher","checked","event"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from \"react\";\r\nimport {\r\n  Button,\r\n  Form,\r\n  Header,\r\n  Image,\r\n  Loader,\r\n  Dimmer,\r\n  Message,\r\n  Segment,\r\n  Check,\r\n  Checkbox,\r\n  Icon,\r\n  Container,\r\n} from \"semantic-ui-react\";\r\nimport { Sidebar } from \"../Dashboard/Sidebar\";\r\nimport AgoraLogo from \"../../images/logo.png\";\r\nimport { useUserContext } from \"../../context/userContext\";\r\nimport { updateEmail, updatePassword } from \"firebase/auth\";\r\nimport { auth } from \"../../firebase-config\";\r\nimport { ref, getDownloadURL, uploadBytesResumable } from \"firebase/storage\";\r\nimport { updateDoc, doc } from \"firebase/firestore\";\r\nimport { db, storage } from \"../../firebase-config\";\r\nexport const Profile = () => {\r\n  const initialState = {\r\n    userName: \"\",\r\n    email: \"\",\r\n    address: \"\",\r\n    birthdate: \"\",\r\n    phoneNumber: \"\",\r\n    password: \"\",\r\n    confirmPassword: \"\",\r\n    role: \"student\",\r\n    avatarUrl: \"https://react.semantic-ui.com/images/wireframe/image.png\",\r\n    avatar: null,\r\n  };\r\n  const initalChangeState = {\r\n    userName: false,\r\n    email: false,\r\n    address: false,\r\n    birthdate: false,\r\n    phoneNumber: false,\r\n    password: false,\r\n    confirmPassword: false,\r\n    role: false,\r\n    avatarUrl: false,\r\n    avatar: false,\r\n  };\r\n\r\n  const [loading, setLoading] = useState(false);\r\n  const [formState, setFormState] = useState(initialState);\r\n  const [formChangeState, setChangeState] = useState(initalChangeState);\r\n  const [isUpdateInProgress, setUpdateInProgress] = useState(false);\r\n  const { updateUserPassword, currentUser } = useUserContext();\r\n  const [isSuccess, setIsSuccess] = useState(false);\r\n  const [passAndConfirmPass, setPassAndConfirmPass] = useState(true);\r\n  const [passValid, setPassValid] = useState(true);\r\n  useEffect(() => {\r\n    const getProfile = async () => {\r\n      try {\r\n        setFormState((prev) => ({\r\n          ...prev,\r\n          role: currentUser.role,\r\n          email: currentUser.email,\r\n          phoneNumber: currentUser.phone,\r\n          address: currentUser.address,\r\n          birthdate: currentUser.birthdate,\r\n          avatarUrl:\r\n            currentUser.avatar == undefined\r\n              ? \"/images/uicon.png\"\r\n              : currentUser.avatar,\r\n          userName: currentUser.uname,\r\n        }));\r\n        console.log(formState);\r\n      } catch (err) {\r\n        console.log(err);\r\n      }\r\n    };\r\n    getProfile();\r\n    //console.log(currentUser.role);\r\n  }, []);\r\n  const handleUpdate = async () => {\r\n    console.log(formState);\r\n    console.log(formChangeState);\r\n    console.log(formState.isTeacher);\r\n\r\n    // if (\r\n    //   formState.userName == \"\"||\r\n    //   formState.email === \"\" ||\r\n    //   formState.phoneNumber == \"\"||\r\n    //   formState.password === \"\" ||\r\n    //   formState.confirmPassword === \"\" ||\r\n    //   formState.avatar === null\r\n    // )\r\n    // {\r\n    //     return;\r\n    // }\r\n    if (formState.confirmPassword !== formState.password) {\r\n      setPassAndConfirmPass(false);\r\n      return;\r\n    }\r\n\r\n    // if (\r\n    //   !formState.password.match(\r\n    //     /^(?=.*?[A-Z])(?=.*?[a-z])(?=.*?[0-9])(?=.*?[#?!@$%^&*-]).{8,}$/g\r\n    //   )\r\n    // ) {\r\n    //   setPassValid(false);\r\n    //   return;\r\n    // }\r\n\r\n    try {\r\n      setUpdateInProgress(true);\r\n      //if(formChangeState.email == true)\r\n      //const { user } = await updateUserPassword(formState.password);\r\n      if (formChangeState.avatar) {\r\n        const storageRef = ref(storage, `images/${formState.topicSubject}`);\r\n        const uploadTask = uploadBytesResumable(storageRef, formState.avatar);\r\n\r\n        // Listen for state changes, errors, and completion of the upload.\r\n        uploadTask.on(\r\n          \"state_changed\",\r\n          (snapshot) => {\r\n            // Get task progress, including the number of bytes uploaded and the total number of bytes to be uploaded\r\n            const progress =\r\n              (snapshot.bytesTransferred / snapshot.totalBytes) * 100;\r\n            console.log(\"Upload is \" + progress + \"% done\");\r\n            switch (snapshot.state) {\r\n              case \"paused\":\r\n                console.log(\"Upload is paused\");\r\n                break;\r\n              case \"running\":\r\n                console.log(\"Upload is running\");\r\n                break;\r\n            }\r\n          },\r\n          (error) => {\r\n            // A full list of error codes is available at\r\n            // https://firebase.google.com/docs/storage/web/handle-errors\r\n            switch (error.code) {\r\n              case \"storage/unauthorized\":\r\n                // User doesn't have permission to access the object\r\n                break;\r\n              case \"storage/canceled\":\r\n                // User canceled the upload\r\n                break;\r\n\r\n              // ...\r\n\r\n              case \"storage/unknown\":\r\n                // Unknown error occurred, inspect error.serverResponse\r\n                break;\r\n            }\r\n          },\r\n          () => {\r\n            // Upload completed successfully, now we can get the download URL\r\n            getDownloadURL(uploadTask.snapshot.ref).then(\r\n              async (downloadURL) => {\r\n                const userCollDoc = doc(db, \"users\", currentUser.uid);\r\n                await updateDoc(userCollDoc, {\r\n                  avatar: downloadURL,\r\n                });\r\n                setLoading(false);\r\n                setUpdateInProgress(false);\r\n              }\r\n            );\r\n          }\r\n        );\r\n      }\r\n      console.log(currentUser.uid);\r\n      const userDoc = doc(db, \"users\", currentUser.uid);\r\n      await updateDoc(userDoc, {\r\n        address: formState.address,\r\n        phone: formState.phoneNumber,\r\n        birthdate: formState.birthdate,\r\n      });\r\n      setIsSuccess(true);\r\n      setLoading(false);\r\n      setUpdateInProgress(false);\r\n    } catch (err) {\r\n      console.log(err);\r\n      setIsSuccess(false);\r\n      setUpdateInProgress(false);\r\n    }\r\n  };\r\n  const handleImageChange = (ev) => {\r\n    console.log(\"AA\" + URL.createObjectURL(ev.target.files[0]));\r\n    setFormState((prev) => ({\r\n      ...prev,\r\n      avatarUrl: URL.createObjectURL(ev.target.files[0]),\r\n      [ev.target.id]: ev.target.files[0],\r\n    }));\r\n    setChangeState((prev) => ({ ...prev, avatarUrl: true, avatar: true }));\r\n  };\r\n  const handleChange = (ev) => {\r\n    setFormState((prev) => ({ ...prev, [ev.target.id]: ev.target.value }));\r\n    setChangeState((prev) => ({ ...prev, [ev.target.id]: true }));\r\n  };\r\n  const handleChangeTeacher = (ev) => {\r\n    setFormState((prev) => ({\r\n      ...prev,\r\n      [ev.target.id]: ev.target.checked == 0 ? \"student\" : \"teacher\",\r\n    }));\r\n  };\r\n  return (\r\n    <Sidebar>\r\n      {loading && (\r\n        <Dimmer active>\r\n          <Loader size=\"mini\">Submitting your question....</Loader>\r\n        </Dimmer>\r\n      )}\r\n      <Form size=\"large\" onSubmit={handleUpdate}>\r\n        <Segment stacked>\r\n          <Form.Input\r\n            label={\r\n              <Image\r\n                label=\"UserFileImage\"\r\n                src={formState.avatarUrl}\r\n                size=\"medium\"\r\n              />\r\n            }\r\n            placeholder=\"\"\r\n            onChange={handleImageChange}\r\n            type=\"file\"\r\n            id=\"avatar\"\r\n            size=\"small\"\r\n          />\r\n\r\n          <Form.Input\r\n            fluid\r\n            label=\"UserName\"\r\n            icon=\"user\"\r\n            iconPosition=\"left\"\r\n            id=\"userName\"\r\n            onChange={handleChange}\r\n            defaultValue={formState.userName}\r\n          />\r\n          <Form.Group widths=\"equal\">\r\n            <Form.Input\r\n              fluid\r\n              label=\"Email Address\"\r\n              icon=\"mail\"\r\n              iconPosition=\"left\"\r\n              id=\"email\"\r\n              onChange={handleChange}\r\n              defaultValue={formState.email}\r\n            />\r\n            <Form.Input\r\n              fluid\r\n              label=\"Phone Number\"\r\n              icon=\"phone\"\r\n              iconPosition=\"left\"\r\n              type=\"tel\"\r\n              onChange={handleChange}\r\n              id=\"phoneNumber\"\r\n              defaultValue={formState.phoneNumber}\r\n              onKeyPress={(event) => {\r\n                //if (!/[0-9]/.test(event.key)) {\r\n                //  event.preventDefault();\r\n                //}\r\n              }}\r\n            />\r\n          </Form.Group>\r\n          <Form.Group widths=\"equal\">\r\n            <Form.Input\r\n              fluid\r\n              label=\"Address\"\r\n              icon=\"address card\"\r\n              iconPosition=\"left\"\r\n              id=\"address\"\r\n              type=\"address\"\r\n              defaultValue={formState.address}\r\n              onChange={handleChange}\r\n            />\r\n            <Form.Input\r\n              fluid\r\n              label=\"DOB\"\r\n              icon=\"calendar\"\r\n              iconPosition=\"left\"\r\n              id=\"birthdate\"\r\n              type=\"date\"\r\n              defaultValue={formState.birthdate}\r\n              onChange={handleChange}\r\n            />\r\n          </Form.Group>\r\n          {/* <Form.Input\r\n            fluid\r\n            label=\"Old Password\"\r\n            icon=\"lock\"\r\n            iconPosition=\"left\"\r\n            placeholder=\"Password\"\r\n            onChange={handleChange}\r\n            type=\"password\"\r\n            id=\"oldPassword\"\r\n          /> */}\r\n          {/* <Form.Input\r\n            fluid\r\n            label=\"New Password\"\r\n            icon=\"lock\"\r\n            iconPosition=\"left\"\r\n            placeholder=\"Password\"\r\n            onChange={ handleChange }\r\n            type=\"password\"\r\n            id=\"password\"\r\n          />\r\n          <Form.Input\r\n            fluid\r\n            label=\"Confirm New Password\"\r\n            icon=\"lock\"\r\n            iconPosition=\"left\"\r\n            placeholder=\"Confirm Password\"\r\n            onChange={ handleChange }\r\n            type=\"password\"\r\n            id=\"confirmPassword\"\r\n          />\r\n          <h1 style={{textTransform :'uppercase'}}>{currentUser.role}</h1> */}\r\n          <Button color=\"teal\" fluid size=\"large\" type=\"submit\">\r\n            {isUpdateInProgress ? (\r\n              <Dimmer active>\r\n                <Loader size=\"mini\">Loading</Loader>\r\n              </Dimmer>\r\n            ) : (\r\n              \"Update\"\r\n            )}\r\n          </Button>\r\n        </Segment>\r\n      </Form>\r\n    </Sidebar>\r\n  );\r\n};\r\n"]},"metadata":{},"sourceType":"module"}